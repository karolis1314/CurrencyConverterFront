<!DOCTYPE html>
<html>
<body style="background-color:#D0D0D0">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<style>

#wrapper {
  /* width: 1000px;
  position: fixed;
  top: 50%;
  left: 50%; */
  /* bring your own prefixes */
  /* transform: translate(-50%, -50%); */
}

table {
  border: 1px solid black;
  width: 100%;
}

th,
td {
  width: 500px;
  border: 1px solid black;
  overflow: hidden;
}

thead>tr {
  position: relative;
  display: block;
  background-color: aliceblue;
  margin-right: 17px;
}

tbody {
  display: block;
  height: 500px;
  overflow: auto;
  background-color: aliceblue;
}
#getAll{
    width: 200px;
    height: 40px;
}
#getOne{
    width: 200px;
    height: 40px;
}
#getOnePeriod{
    width: 200px;
    height: 40px;
}
#calculate{
    width: 200px;
    height: 40px;
}
#country{
    width: 300px;
    height: 40px;
}
#amount{
    width: 300px;
    height: 40px;
}

#headingOfAll{
    text-align: center;
}

#contentContainer{
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	gap: 10px
}

</style>
<div id="contentContainer">
	<div id="headingOfAll">
		<h1 id="h1Change">Currency Display and Calculator</h1>
	</div>
	<div id="textContainer">
		<input type="text" id = "country" maxlength="3" placeholder="Enter Country">
		<input type="text" id = "amount" placeholder="Enter Amount">
	</div>
	<div id= "container">
		<button id="getAll" onclick='loadThejson("http://localhost:8080/db/all");'> Show Current </button>
		<button id="getOne" onclick='loadThejsonOne();'> Show One </button>
		<button id="getOnePeriod" onclick='callBoth("http://localhost:8080/db/all/period");'> Show Period </button>
		<button id="calculate" onclick='calculateOne();'> Calculate </button>
	</div>
	<div id="wrapper">
	<table class="table" style="overflow-y:scroll">
		<thead>
		<tr  class="bg-info">
			<th>Country</th>
			<th>Currency</th>
		</tr>
	</thead>
		<tbody id="myTable">   
		</tbody>
	</table>
	</div>
</div>

<script>
	async function loadThejson(url){
	const response = await fetch(url);
	const data = await response.json();
	buildTable(data)
	console.log(data)
	}

	async function loadPeriod(url){
		var input = document.getElementById("country").value;
		await fetch("http://localhost:8080/range/"+input.toUpperCase()+"/2021-05-05/2021-09-05");
		const response = await fetch(url);
		const data = await response.json();
		buildTable(data)
	}

	async function loadDb(url){
		await fetch(url)
	}

	async function loadThejsonOne(){
	var input = document.getElementById("country").value;
	const response = await fetch("http://localhost:8080/db/one/"+input.toUpperCase());
	const data = await response.json();
	buildTableOne(data)
	console.log(data)
	}

	async function calculateOne(){
	var input = document.getElementById("country").value;
	var inputNumber = parseFloat(document.getElementById("amount").value);
	console.log(inputNumber);
	const response = await fetch("http://localhost:8080/db/one/"+input.toUpperCase());
	const data = await response.json();
	var outputNumber = parseFloat(data.value);
	var converted = inputNumber * outputNumber;
	document.getElementById("h1Change").innerHTML = "You get "+converted.toFixed(2)+data.name+" out of "+inputNumber+"â‚¬ on "+outputNumber+" rate."
	}

	function callBoth(url){
		loadPeriod(url);
	}



	function buildTable(data){
		var table = document.getElementById('myTable')
		table.innerHTML = ""

		for (var i = 0; i < data.length; i++){
			var row = `<tr>
							<td>${data[i].name}</td>
							<td>${data[i].value}</td>
					  </tr>`
			table.innerHTML += row


		}
	}

	function buildTableOne(data){
		var table = document.getElementById('myTable')
		table.innerHTML = ""
			var row = `<tr>
							<td>${data.name}</td>
							<td>${data.value}</td>
					  </tr>`
			table.innerHTML += row
	}

	var setJob = (async function(){
		await loadDb("http://localhost:8080/runJob");
	})();

	setJob;

</script>

</body>
</html>